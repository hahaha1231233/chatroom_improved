# Online Chatroom V2

ä¸€ä¸ªåŸºäº Java Web æŠ€æœ¯çš„åœ¨çº¿èŠå¤©å®¤ç³»ç»Ÿï¼Œæ”¯æŒå…¬å…±èŠå¤©ã€ç§å¯†èŠå¤©ã€ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªæ”¹è¿›ç‰ˆçš„åœ¨çº¿èŠå¤©å®¤åº”ç”¨ï¼Œä½¿ç”¨ Java Servletã€JSPã€JSTL ç­‰æŠ€æœ¯å®ç°ã€‚ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€å®æ—¶æ¶ˆæ¯ä¼ é€’ã€ç§èŠä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ ˆ
- **åç«¯**: Java Servlet 4.0+, JSP, JSTL
- **å‰ç«¯**: HTML5, CSS3, JavaScript
- **æœåŠ¡å™¨**: Tomcat 10+
- **æ•°æ®å­˜å‚¨**: ServletContext åº”ç”¨çº§å­˜å‚¨
- **æ¨¡æ¿å¼•æ“**: JSP + JSTL æ ‡ç­¾åº“

### ç›®å½•ç»“æ„
```
chatroom_improved_version/
â”œâ”€â”€ src/main/java/com/chatroom_improved_version/
â”‚   â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Message.java    # æ¶ˆæ¯å®ä½“ç±»
â”‚   â”‚   â””â”€â”€ PrivateMessage.java # ç§èŠæ¶ˆæ¯å®ä½“ç±»
â”‚   â”œâ”€â”€ servlet/           # Servletæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ LoginServlet.java      # ç™»å½•å¤„ç†
â”‚   â”‚   â”œâ”€â”€ LogoutServlet.java     # ç™»å‡ºå¤„ç†
â”‚   â”‚   â”œâ”€â”€ ChatRoomServlet.java   # å…¬å…±èŠå¤©å®¤
â”‚   â”‚   â””â”€â”€ PrivateChatServlet.java # ç§èŠå¤„ç†
â”œâ”€â”€ webapp/
â”‚   â”œâ”€â”€ WEB-INF/
â”‚   â”‚   â””â”€â”€ web.xml        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ index.jsp          # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ chat.jsp           # ä¸»èŠå¤©å®¤é¡µé¢
â”‚   â””â”€â”€ private-chat.jsp   # ç§èŠé¡µé¢
â””â”€â”€ README.md
```

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·ç®¡ç†
- **ç”¨æˆ·ç™»å½•**: æ˜µç§°éªŒè¯ï¼Œé˜²æ­¢é‡å¤ç™»å½•
- **åœ¨çº¿çŠ¶æ€**: å®æ—¶æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·åˆ—è¡¨
- **è‡ªåŠ¨ç™»å‡º**: 30åˆ†é’Ÿä¼šè¯è¶…æ—¶
- **é€€å‡ºé€šçŸ¥**: ç”¨æˆ·ç¦»å¼€æ—¶å¹¿æ’­ç³»ç»Ÿæ¶ˆæ¯

### 2. æ¶ˆæ¯ç³»ç»Ÿ
- **å…¬å…±èŠå¤©**: æ‰€æœ‰ç”¨æˆ·å¯è§çš„ç¾¤èŠæ¶ˆæ¯
- **ç§å¯†èŠå¤©**: ä¸€å¯¹ä¸€ç§èŠä¼šè¯
- **ç³»ç»Ÿæ¶ˆæ¯**: ç”¨æˆ·åŠ å…¥/ç¦»å¼€é€šçŸ¥
- **æ¶ˆæ¯è¿‡æ»¤**: åªæ˜¾ç¤ºç›¸å…³çš„ç§èŠæ¶ˆæ¯

### 3. æ¶ˆæ¯ç®¡ç†
- **æ¶ˆæ¯æŒä¹…åŒ–**: ServletContext å­˜å‚¨èŠå¤©è®°å½•
- **å®¹é‡é™åˆ¶**: 
  - å…¬å…±æ¶ˆæ¯: ä¿ç•™æœ€è¿‘100æ¡
  - ç§èŠæ¶ˆæ¯: æ¯ä¸ªä¼šè¯ä¿ç•™æœ€è¿‘50æ¡
- **æœªè¯»æ ‡è®°**: ç§èŠæ¶ˆæ¯æœªè¯»çŠ¶æ€æ ‡è¯†

### 4. ç•Œé¢ç‰¹æ€§
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **å®æ—¶åˆ·æ–°**: å®šæ—¶è‡ªåŠ¨åˆ·æ–°æ¶ˆæ¯
- **æ¶ˆæ¯åˆ†ç±»**: ä¸åŒæ ·å¼åŒºåˆ†æ¶ˆæ¯ç±»å‹
- **ç”¨æˆ·äº¤äº’**: ç‚¹å‡»ç”¨æˆ·å¤´åƒå‘èµ·ç§èŠ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- JDK 11+
- Apache Tomcat 10+
- Maven 3.6+

### éƒ¨ç½²æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   ```

2. **æ„å»ºé¡¹ç›®**
   ```bash
   mvn clean package
   ```

3. **éƒ¨ç½²åˆ°Tomcat**
   - å°†ç”Ÿæˆçš„ WAR æ–‡ä»¶å¤åˆ¶åˆ° Tomcat çš„ `webapps` ç›®å½•
   - å¯åŠ¨ Tomcat æœåŠ¡å™¨

4. **è®¿é—®åº”ç”¨**
   ```
   http://localhost:8080/chatroom_improved_version/
   ```

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶
- **web.xml**: åº”ç”¨é…ç½®ï¼Œä¼šè¯è¶…æ—¶è®¾ç½®ï¼Œæ¬¢è¿é¡µé¢

### æ•°æ®æ¨¡å‹
- **Message.java**: æ¶ˆæ¯å®ä½“ï¼Œæ”¯æŒå…¬å…±/ç§èŠ/ç³»ç»Ÿä¸‰ç§ç±»å‹
- **PrivateMessage.java**: ç§èŠæ¶ˆæ¯å®ä½“ï¼ŒåŒ…å«å·²è¯»çŠ¶æ€ç®¡ç†

### Servletæ§åˆ¶å™¨
- **LoginServlet.java**: å¤„ç†ç”¨æˆ·ç™»å½•ï¼Œæ£€æŸ¥æ˜µç§°å”¯ä¸€æ€§
- **ChatRoomServlet.java**: ä¸»èŠå¤©å®¤æ§åˆ¶å™¨ï¼Œå¤„ç†æ¶ˆæ¯å‘é€
- **PrivateChatServlet.java**: ç§èŠæ§åˆ¶å™¨ï¼Œç®¡ç†ç§èŠä¼šè¯
- **LogoutServlet.java**: å¤„ç†ç”¨æˆ·ç™»å‡ºï¼Œæ¸…ç†åœ¨çº¿çŠ¶æ€

### è§†å›¾é¡µé¢
- **index.jsp**: ç™»å½•é¡µé¢ï¼Œè¾“å…¥æ˜µç§°è¿›å…¥èŠå¤©å®¤
- **chat.jsp**: ä¸»èŠå¤©å®¤é¡µé¢ï¼Œæ˜¾ç¤ºå…¬å…±èŠå¤©å’Œåœ¨çº¿ç”¨æˆ·
- **private-chat.jsp**: ç§èŠé¡µé¢ï¼Œæ˜¾ç¤ºä¸€å¯¹ä¸€èŠå¤©ä¼šè¯

## ğŸ”§ å…³é”®æŠ€æœ¯å®ç°

### å¹¶å‘æ§åˆ¶
```java
// ä½¿ç”¨ synchronized ä¿è¯çº¿ç¨‹å®‰å…¨
synchronized (onlineUsers) {
    onlineUsers.put(trimmed, session.getId());
}
```

### æ¶ˆæ¯è¿‡æ»¤
```java
// åªæ˜¾ç¤ºå½“å‰ç”¨æˆ·ç›¸å…³çš„ç§èŠæ¶ˆæ¯
if (msg.isPublic() || msg.isSystem() ||
    (msg.isPrivate() && (msg.getSender().equals(currentUser) ||
                         msg.getTargetUser().equals(currentUser)))) {
    filteredMessages.add(msg);
}
```

### ç§èŠä¼šè¯ç®¡ç†
```java
// ç”Ÿæˆå”¯ä¸€çš„ä¼šè¯é”®
private String getConversationKey(String user1, String user2) {
    if (user1.compareTo(user2) < 0) {
        return user1 + ":" + user2;
    } else {
        return user2 + ":" + user1;
    }
}
```

## ğŸ¨ ç•Œé¢ç‰¹è‰²

### æ¶ˆæ¯æ ·å¼
- **å…¬å…±æ¶ˆæ¯**: ç™½è‰²èƒŒæ™¯ï¼Œæ™®é€šæ ·å¼
- **ç§èŠæ¶ˆæ¯**: è“è‰²è¾¹æ¡†ï¼Œæ ‡æ³¨"ç§èŠ"æ ‡è¯†
- **ç³»ç»Ÿæ¶ˆæ¯**: ç°è‰²èƒŒæ™¯ï¼Œå±…ä¸­æ˜¾ç¤º

### ç”¨æˆ·ç•Œé¢
- **åœ¨çº¿ç”¨æˆ·åˆ—è¡¨**: å®æ—¶æ›´æ–°ï¼Œæ˜¾ç¤ºç§èŠæŒ‰é’®
- **æ¶ˆæ¯æ—¶é—´æˆ³**: ç²¾ç¡®åˆ°ç§’çš„æ—¶é—´æ˜¾ç¤º
- **æœªè¯»æ¶ˆæ¯**: çº¢è‰²åœ†ç‚¹æ ‡è¯†æœªè¯»ç§èŠ

### äº¤äº’ä½“éªŒ
- **è‡ªåŠ¨æ»šåŠ¨**: æ–°æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸ
- **å¿«æ·é”®**: å›è½¦é”®å¿«é€Ÿå‘é€æ¶ˆæ¯
- **å®æ—¶åˆ·æ–°**: å®šæ—¶åˆ·æ–°è·å–æ–°æ¶ˆæ¯

## âš™ï¸ é…ç½®è¯´æ˜

### ä¼šè¯é…ç½®
```xml
<session-config>
    <session-timeout>30</session-timeout>
</session-config>
```

### æ¶ˆæ¯å®¹é‡
- ä¿®æ”¹ `ChatRoomServlet.java` ä¸­çš„ `100` è°ƒæ•´å…¬å…±æ¶ˆæ¯å®¹é‡
- ä¿®æ”¹ `PrivateChatServlet.java` ä¸­çš„ `50` è°ƒæ•´ç§èŠæ¶ˆæ¯å®¹é‡

### åˆ·æ–°é¢‘ç‡
- å…¬å…±èŠå¤©å®¤: 10ç§’è‡ªåŠ¨åˆ·æ–°
- ç§èŠé¡µé¢: 5ç§’è‡ªåŠ¨åˆ·æ–°

